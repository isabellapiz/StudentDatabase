import java.sql.*;
import java.util.Scanner;

public class DriverManagerTester
{
    static Scanner scan = new Scanner(System.in);

    public static void main(String[] argv) {

        Connection connection;

        int choice = printMenu();
        
        try {
            connection = DriverManager.getConnection("jdbc:mysql://127.0.0.1:3306/studentdatabase?user=root","root", "ENTER_PASSWORD_HERE");

            if(choice == 1) {
                getAvgGPAForEachGrade(connection);
            }
            else if(choice == 2)
            {
                insertNewTeacher(connection);
            }

            else if(choice == 3)
            {
                getAllStudentInfo(connection);
            }


        } catch (SQLException e) {
            System.out.println("Connection Failed! Check output console");
            e.printStackTrace();
            return;
        }

        if (connection == null) {
            System.out.println("Failed to make connection!");
        }
    }

    public static int printMenu()
    {
        System.out.println("Welcome to the student database. Please select from the following options:");
        System.out.println("1. View Average Unweighted GPA for Each Grade");
        System.out.println("2. Insert a New Teacher");
        System.out.println("3. View All Students Currently Enrolled");
        return scan.nextInt();
    }

    public static void getAvgGPAForEachGrade(Connection connection) throws java.sql.SQLException
    {
        Statement stmt = connection.createStatement();
        ResultSet rs = stmt.executeQuery("select grade, round(avg(unweightedGPA),2) AS averageGPA from Student NATURAL JOIN StudentGrades group by grade order by grade");
        while (rs.next())
            System.out.println("Grade=" + rs.getInt(1) + " Unweighted GPA=" + rs.getDouble(2));
    }

    public static void insertNewTeacher(Connection connection) throws java.sql.SQLException
    {
        Statement stmt = connection.createStatement();
        System.out.println("Please enter the teacher ID number: ");
        int tID = scan.nextInt();
        scan.nextLine();
        System.out.println("Please enter the teacher's subject: ");
        String subject = scan.nextLine();
        System.out.println("Please enter the teacher's first name: ");
        String firstName = scan.nextLine();
        System.out.println("Please enter the teacher's last name: ");
        String lastName = scan.nextLine();
        stmt.execute("insert into Teacher values ("+tID+",'"+subject+"','"+firstName+"','"+lastName+"')");
        Statement stmt2 = connection.createStatement();
        ResultSet rs = stmt2.executeQuery("select * from Teacher");

        while (rs.next())
            System.out.println("tID=" + rs.getInt(1) + "    Subject=" +rs.getString(2) + "   FirstName=" + rs.getString(3) +
                    "   LastName=" + rs.getString(4));
    }

    public static void getAllStudentInfo(Connection connection) throws java.sql.SQLException
    {
        Statement stmt = connection.createStatement();
        ResultSet rs = stmt.executeQuery("select sID, firstName, lastName from Student");
        while(rs.next())
            System.out.println("sID="+rs.getInt(1) + "  FirstName="+rs.getString(2) + "     LastName=" +rs.getString(3));
    }
}
